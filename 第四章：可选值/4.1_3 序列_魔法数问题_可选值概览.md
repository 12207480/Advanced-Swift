# 可选值

##  4.1哨岗值 Sentinel Value
定义：有的函数可能返回nil 当函数返回nil 我们将返回值 用作-1 等类似的值代替，这样的值就被称为["哨岗值"](https://en.wikipedia.org/wiki/Sentinel_value) 也叫魔法数。



## 4.2通过枚举来解决魔法数的问题
swift中Optional的本质是一个枚举(目前可以先不具体思考，等以后的项目中慢慢就领悟到了)。

    enum Optional<Wrapped> {
        case none //为空
        case some(wrapped) // 有值
    }
    

知识点：当返回值为可选值 ? 时，实质上返回的是一个Optional的枚举

        ///返回值为Optional的实质
        let strArray = ["one","two","three"]
        switch strArray.index(of: "four") {
        case .none:
            print("返回值为空") //返回值为空
        case .some(let idx):
            print(idx)
            print("有值")
        }

## 4.3可选值概览：Optional

### if let  
相信大家在swift 入门的时候就已经能很好的使用这个语法了。 不赘述。

#### 技巧1： 可与Bool 联合判断
    if let obj = Optional , Bool {
        /// 前面有值且后面Bool为true执行
    }

#### 技巧2： 多let 并列。 这个在开发中也经常用到

    if let obj1 = Optional1, let obj2 = Optional2, ....{
    ///当上面的let判断都有值的时候执行
    }


### while let 
类似于if let 遇到```nil时终止循环```
也有和上面👆技巧1（```一旦为false 就循环停止，并不是filter那样去工作```）相同的使用方法。不赘述。
      
        while let line = printLine() {
        ///当printLine为空时候终止循环
            print(line)
        }


### 双重可选值:
一个可选值可能会被另外一个可选值包装起来，形成了可选值的嵌套。你也可以理解成obj?? 。平时在复杂逻辑操作时注意一哈就可以了。

### if var 和 while var
和 let 的使用类似。 但你var 出来的obj实际上是一个```本地副本```  你对obj做任何更改都```不会影响```原来的值。
 
     ///if var 的改变不影响原值
            let dict:[String:String]?
            dict = ["key1":"value1"]
            if var varDict = dict {
                varDict["key1"] = "value2"
            }
            print(dict) //Optional(["key1": "value1"])


### 解包后可选值的作用域
    if let obj = Optional {
    ///obj的作用域
    }

#### 注:有时候我们需要```提前退出```来避免烦人的if嵌套，这个时候 ```guard let``` 的优点马上就体现出来了.

    ///为空提前退出
    guard let obj = Optional else{return}



### 可选链
OC中对nil发送消息nothing had happened。 在swift中可以通过可选链（Optional chaining）达到一样的效果

那么问题来了，什么是可选链？
```可选链``` 中的可选是```?```,可以把链理解成swift中的点语法,可以在《swift链式编程》一书中对这个有更深的理解

    delegate?.callback() //就是一个可选链。

    //当上面的delegate为可选时编译器会发出警告。 确实有值方法会被调用。没有值时候方法不会被调用。
    
   
   ps. 😂写了这么多年swift的delegate和闭包 直到自己写笔记的时候才发现自己写复杂了(一点swift的优点都没体现出来。。。)
   
    var voidCallback:(()-> Void)?
        
        ///对于闭包调用的两种写法
        //❌不推荐
        if voidCallback != nil {
            voidCallback!()
        }
        
        //✅ 推荐
        voidCallvack?()
        

#### 多个可选链的调用。下面这个例子简单易懂，不赘述。

    extension Int {
        
        var half: Int? {
            guard self > 1 else {return nil}
            return self/2
        }
        
    }
    ///多可选链调用
    20.half?.half?.half //Optional(2)


### nil合并运算符 ??   (项目中经常会用到！！可以让你的代码写的很优美~)
一开始看到标题```nil合并运算符```的时候我是😳的。这都是啥啥啥啊。   当我看到 ```??``` 这个符号时候豁然开朗。两个是一个意思 项目里面已经用过很多次了，百试不爽。
 
```使用场景```:  当去解包```!```一个可选值，且当这个可选值为nil时，我们要去赋一个```默认值```防止崩溃  这个时候就用到了 ```??```   

        var number: Int?
        number = nil
        String(number ?? 5) //5 

感觉上是和OC 中的 三目运算符 Bool ？ A: B 类似
需要强调的是可选值```不是指针```


